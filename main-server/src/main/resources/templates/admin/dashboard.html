<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 대시보드 - 파이낸셜 프리덤</title>
    <link rel="icon" href="/static/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/admin/css/admin-common.css" rel="stylesheet">
</head>
<body>
<div class="admin-wrapper">
    <div th:replace="~{admin/common/sidebar :: sidebar}"></div>
    <div class="admin-content">
        <div th:replace="~{admin/common/header :: header('메인 대시보드', 'fas fa-tachometer-alt', null)}"></div>
        <main class="page-content">
            <div class="welcome-card">
                <h2><i class="fas fa-home me-3"></i>관리자 대시보드에 오신 것을 환영합니다!</h2>
                <p>파이낸셜 프리덤 서비스를 효율적으로 관리할 수 있습니다.</p>
            </div>
            <div class="row mb-4">
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card primary">
                        <div class="stat-icon"><i class="fas fa-newspaper"></i></div>
                        <div class="stat-content">
                            <h3 id="newsCount">0</h3>
                            <p>총 뉴스 수</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card success">
                        <div class="stat-icon"><i class="fas fa-question-circle"></i></div>
                        <div class="stat-content">
                            <h3 id="quizCount">0</h3>
                            <p>총 퀴즈 수</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card warning">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-content">
                            <h3 id="userCount">0</h3>
                            <p>총 사용자 수</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="admin-card">
                <div class="card-header">
                    <h5><i class="fas fa-clock"></i>시스템 시간</h5>
                </div>
                <div class="card-body text-center">
                    <div class="system-time" id="systemTime">로딩 중...</div>
                </div>
            </div>
        </main>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/admin/js/admin-common.js"></script>
<script>
    $(document).ready(function() {
        $('[data-page="dashboard"]').addClass('active');
        loadDashboardData();
        updateSystemTime();
        setInterval(updateSystemTime, 1000); // 매초 시간 업데이트
    });

    function loadDashboardData() {
        $.ajax({
            url: '/admin/api/dashboard/stats',
            method: 'GET',
            success: function(response) {
                // 숫자를 애니메이션으로 카운트업
                animateCount('#newsCount', response.totalNewsCount);
                animateCount('#quizCount', response.totalQuizCount);
                animateCount('#userCount', response.totalUserCount);
            },
            error: function(xhr) {
                console.error('대시보드 데이터 로드 실패:', xhr);
                showToast('대시보드 데이터를 불러오는데 실패했습니다.', 'error');
                // 실패 시 기본값 표시
                $('#newsCount').text('-');
                $('#quizCount').text('-');
                $('#userCount').text('-');
            }
        });
    }

    function animateCount(selector, targetValue) {
        const element = $(selector);
        const startValue = 0;
        const duration = 2000; // 2초
        const startTime = performance.now();

        function updateCount(currentTime) {
            const elapsedTime = currentTime - startTime;
            const progress = Math.min(elapsedTime / duration, 1);
            
            // Easing 함수 적용 (ease-out)
            const easedProgress = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(startValue + (targetValue - startValue) * easedProgress);
            
            element.text(currentValue.toLocaleString()); // 천 단위 콤마 추가
            
            if (progress < 1) {
                requestAnimationFrame(updateCount);
            } else {
                element.text(targetValue.toLocaleString());
            }
        }
        
        requestAnimationFrame(updateCount);
    }

    function updateSystemTime() {
        const now = new Date();
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            timeZone: 'Asia/Seoul',
            hour12: false
        };
        
        const formattedTime = now.toLocaleDateString('ko-KR', options)
            .replace(/\./g, '-')
            .replace(/\s/g, ' ');
            
        $('#systemTime').text(formattedTime + ' (KST)');
    }
</script>
</body>
</html>



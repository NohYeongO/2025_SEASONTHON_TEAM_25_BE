<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>뉴스 상세 - 파이낸셜 프리덤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/admin/css/admin-common.css" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" />
    <style>
        .news-detail-container { max-width: 900px; margin: 0 auto; }
        .news-header { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,.08); margin-bottom: 2rem; }
        .news-title { font-size: 1.8rem; font-weight: 700; color: #2c3e50; line-height: 1.4; margin-bottom: 1rem; }
        .news-meta { display: flex; gap: 2rem; color: #6c757d; font-size: .9rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .news-meta-item { display: flex; align-items: center; gap: .5rem; }
        .news-summary { background: #f8f9fa; border-left: 4px solid #3498db; padding: 1.5rem; border-radius: 0 8px 8px 0; margin-bottom: 1.5rem; }
        .news-summary h6 { color: #3498db; font-weight: 600; margin-bottom: 1rem; }
        .news-content { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,.08); overflow: hidden; }
        .news-content-header { background: #f8f9fa; padding: 1.5rem 2rem; border-bottom: 1px solid #e9ecef; }
        .news-content-body { padding: 2rem; }
        .content-block { margin-bottom: 2rem; line-height: 1.7; }
        .content-block:last-child { margin-bottom: 0; }
        .content-block h3 { color: #2c3e50; font-size: 1.3rem; font-weight: 600; margin-bottom: 1rem; }
        .content-block p { color: #495057; font-size: 1rem; margin-bottom: 1rem; }
        .image-block { margin: 2rem 0; text-align: center; }
        .image-block img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,.1); transition: transform .3s ease; }
        .image-block img:hover { transform: scale(1.02); }
        .action-buttons { position: sticky; bottom: 2rem; text-align: center; margin-top: 3rem; }
        .btn-back { background: linear-gradient(135deg,#6c757d,#495057); border: none; color: white; padding: .75rem 2rem; border-radius: 25px; font-weight: 500; margin-right: 1rem; }
        .btn-delete { background: linear-gradient(135deg,#dc3545,#c82333); border: none; color: white; padding: .75rem 2rem; border-radius: 25px; font-weight: 500; }
        .loading-container { text-align: center; padding: 3rem; color: #6c757d; }
        .error-container { text-align: center; padding: 3rem; color: #dc3545; }
    </style>
</head>
<body>
<div class="admin-wrapper">
    <div th:replace="~{admin/common/sidebar :: sidebar}"></div>
    <div class="admin-content">
        <div th:replace="~{admin/common/header :: header('뉴스 상세', 'fas fa-newspaper', null)}"></div>
        <main class="page-content">
            <div class="news-detail-container">
                <div id="loadingContainer" class="loading-container">
                    <div class="spinner-border text-primary mb-3" role="status"></div>
                    <div>뉴스 상세 정보를 불러오는 중입니다...</div>
                </div>
                <div id="errorContainer" class="error-container d-none">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                    <h5>뉴스를 불러올 수 없습니다</h5>
                    <p id="errorMessage"></p>
                    <button class="btn btn-primary" onclick="loadNewsDetail()">다시 시도</button>
                </div>
                <div id="newsDetailContainer" class="d-none">
                    <div class="news-header">
                        <h1 class="news-title" id="newsTitle"></h1>
                        <div class="news-meta">
                            <div class="news-meta-item"><i class="fas fa-building"></i><span id="newsOrganization"></span></div>
                            <div class="news-meta-item"><i class="fas fa-calendar-alt"></i><span id="newsDate"></span></div>
                            <div class="news-meta-item"><i class="fas fa-link"></i><a href="#" id="newsUrl" target="_blank">원문 보기</a></div>
                        </div>
                        <div class="news-summary"><h6><i class="fas fa-robot me-2"></i>AI 요약</h6><p id="aiSummary" class="mb-0"></p></div>
                    </div>
                    <div class="news-content">
                        <div class="news-content-header"><h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>뉴스 본문</h5></div>
                        <div class="news-content-body" id="newsContentBlocks"></div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-back" onclick="goBackToList()"><i class="fas fa-arrow-left me-2"></i>목록으로</button>
                        <button class="btn btn-delete" onclick="deleteCurrentNews()"><i class="fas fa-trash me-2"></i>삭제</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/admin/js/admin-common.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const newsId = [[${newsId}]];
    let newsData = null;
    $(document).ready(function() { $('[data-page="news"]').addClass('active'); loadNewsDetail(); });
    function loadNewsDetail() {
        showLoading();
        $.ajax({ url: '/admin/api/news/' + newsId, method: 'GET', success: function(response) {
            if (response) { newsData = response; displayNewsDetail(newsData); showNewsDetail(); }
            else { showError('뉴스를 불러오는데 실패했습니다.'); }
        }, error: function(xhr) { console.error('뉴스 상세 로드 실패:', xhr); let msg = '뉴스를 불러오는데 실패했습니다.'; if (xhr.status === 404) msg = '존재하지 않는 뉴스입니다.'; showError(msg); } });
    }
    function displayNewsDetail(news) {
        $('#newsTitle').text(news.newsTitle || '제목 없음');
        $('#newsOrganization').text(news.organizationName || '기관 정보 없음');
        const formattedDate = formatDateTime(news.approvalDate); $('#newsDate').text(formattedDate);
        if (news.newsUrl) { $('#newsUrl').attr('href', news.newsUrl).show().parent().show(); } else { $('#newsUrl').parent().hide(); }
        $('#aiSummary').text(news.aiSummary || 'AI 요약이 없습니다.');
        const contentContainer = $('#newsContentBlocks'); contentContainer.empty();
        if (news.contentBlocks && news.contentBlocks.length > 0) {
            news.contentBlocks.forEach(function(block) {
                let blockHtml = '<div class="content-block">';
                const content = block.content || '';
                if (block.blockType === 'image') {
                    if (block.url) {
                        blockHtml += '<div class="image-block text-center mb-3">';
                        blockHtml += '<img src="' + (block.url) + '" alt="' + (block.altText || '뉴스 이미지') + '" class="img-fluid" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" />';
                        blockHtml += '</div>';
                    } else if (content) {
                        blockHtml += '<p class="text-muted">[이미지: ' + escapeHtml(content) + ']</p>';
                    }
                } else {
                    blockHtml += '<p>' + content + '</p>';
                }
                blockHtml += '</div>';
                contentContainer.append(blockHtml);
            });
        } else { contentContainer.html('<p class="text-muted">본문 내용이 없습니다.</p>'); }
    }
    function formatDateTime(dateString) { if (!dateString) return '-'; const date = new Date(dateString); if (isNaN(date.getTime())) return dateString; const y=date.getFullYear(); const m=String(date.getMonth()+1).padStart(2,'0'); const d=String(date.getDate()).padStart(2,'0'); const h=String(date.getHours()).padStart(2,'0'); const min=String(date.getMinutes()).padStart(2,'0'); return y+'-'+m+'-'+d+' '+h+':'+min; }
    function showLoading() { $('#loadingContainer').removeClass('d-none'); $('#errorContainer').addClass('d-none'); $('#newsDetailContainer').addClass('d-none'); }
    function showNewsDetail() { $('#loadingContainer').addClass('d-none'); $('#errorContainer').addClass('d-none'); $('#newsDetailContainer').removeClass('d-none'); }
    function showError(message) { $('#loadingContainer').addClass('d-none'); $('#newsDetailContainer').addClass('d-none'); $('#errorMessage').text(message); $('#errorContainer').removeClass('d-none'); }
    function goBackToList() { window.location.href = '/admin/news'; }
    function deleteCurrentNews() { if (confirm('정말로 이 뉴스를 삭제하시겠습니까?')) { $.ajax({ url: '/admin/api/news/' + newsId, method: 'DELETE', success: function() { alert('뉴스가 성공적으로 삭제되었습니다.'); window.location.href = '/admin/news'; }, error: function(xhr) { console.error('뉴스 삭제 실패:', xhr); alert('뉴스 삭제에 실패했습니다.'); } }); } }
    function escapeHtml(string) { const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }; return String(string).replace(/[&<>"']/g, function(m) { return map[m]; }); }
    /*]]>*/
</script>
</body>
</html>



<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>퀴즈 상세 - 파이낸셜 프리덤</title>
    <link rel="icon" href="/static/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/admin/css/admin-common.css" rel="stylesheet">
</head>
<body>
<div class="admin-wrapper">
    <div th:replace="~{admin/common/sidebar :: sidebar}"></div>
    <div class="admin-content">
        <div th:replace="~{admin/common/header :: header('퀴즈 상세', 'fas fa-question-circle', null)}"></div>
        <main class="page-content">
            <div class="row mb-3">
                <div class="col-md-12 text-end">
                    <a href="/admin/quiz" class="btn btn-secondary me-2">
                        <i class="fas fa-arrow-left me-1"></i>목록으로 돌아가기
                    </a>
                    <button type="button" class="btn btn-danger" onclick="deleteQuiz()">
                        <i class="fas fa-trash me-1"></i>삭제
                    </button>
                </div>
            </div>
            <div class="container">
                <div id="cardContainer" class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <span id="typeBadge" class="badge bg-secondary">TYPE</span>
                                <span id="categoryBadge" class="badge bg-primary ms-2">카테고리</span>
                            </div>
                            <a id="newsLink" href="#" target="_blank" class="btn btn-sm btn-outline-secondary">원본보기</a>
                        </div>

                        <h5 class="mb-3" id="question">문제</h5>

                        <div id="oxAnswerWrap" class="mb-3 d-none">
                            <div class="alert alert-info"><strong>정답</strong>: <span id="oxAnswerText"></span></div>
                        </div>

                        <div id="mcqWrap" class="mb-3 d-none">
                            <ul class="list-group" id="mcqList"></ul>
                        </div>

                        <div class="mt-4">
                            <h6><i class="fas fa-lightbulb me-2"></i>해설</h6>
                            <p id="explanation" class="mb-0 text-muted"></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/admin/js/admin-common.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const quizId = [[${quizId}]];
    $(document).ready(function(){ $('[data-page="quiz"]').addClass('active'); loadDetail(); });

    function loadDetail(){
        $.ajax({ url: '/admin/api/quiz/'+quizId, method: 'GET', success: function(r){ renderDetail(r); }, error: function(){ showToast('퀴즈 상세 로드 실패','error'); }});
    }

    function renderDetail(r){
        $('#question').text(r.question || '');
        $('#explanation').text(r.explanation || '');
        $('#categoryBadge').text(r.category || '');
        $('#typeBadge').text(r.type === 'OX' ? 'OX' : '4지선다');
        if (r.newsArticleId){ $('#newsLink').attr('href','/admin/news/'+r.newsArticleId).show(); } else { $('#newsLink').hide(); }

        if (r.type === 'OX'){
            $('#oxAnswerWrap').removeClass('d-none');
            $('#mcqWrap').addClass('d-none');
            $('#oxAnswerText').text(r.oxAnswer ? 'O (참)' : 'X (거짓)');
        } else {
            $('#oxAnswerWrap').addClass('d-none');
            $('#mcqWrap').removeClass('d-none');
            const list = $('#mcqList'); list.empty();
            const opts = [r.mcqOption1, r.mcqOption2, r.mcqOption3, r.mcqOption4];
            for (let i=0;i<opts.length;i++){
                const isCorrect = (i+1) === r.mcqCorrectIndex;
                const badge = isCorrect ? '<span class="badge bg-success ms-2">정답</span>' : '';
                list.append('<li class="list-group-item d-flex justify-content-between align-items-center">'+escapeHtml(opts[i]||'')+badge+'</li>');
            }
        }
    }
    function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#039;"); }
    
    function deleteQuiz(){
        if(!confirm('정말 이 퀴즈를 삭제하시겠습니까?')) return;
        $.ajax({ 
            url: '/admin/api/quiz/'+quizId, 
            method: 'DELETE', 
            success: function(){ 
                showToast('퀴즈가 삭제되었습니다','success'); 
                setTimeout(() => window.location.href = '/admin/quiz', 1500);
            }, 
            error: function(){ 
                showToast('퀴즈 삭제 실패','error'); 
            }
        });
    }
    /*]]>*/
</script>
</body>
</html>


